<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>管理员界面</title>
  <meta name="description" content="这是管理员主页">
  <meta name="keywords" content="index">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="../img/ahut.ico">
  <link rel="stylesheet" href="../amazeui/css/amazeui.min.css" />
  <link rel="stylesheet" href="../css/pagination.css">
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet" href="css/style.css"/>
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/font-awesome.min.css" />
  <link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.full.min.css">
  <link rel="stylesheet" href="assets/css/ace.min.css" />
</head>

<body style="overflow:hidden;" >
  <div class="user_Manager_style">
    <div class="teacher_search_title am-panel am-panel-default">
      <div class="am-panel am-panel-default">
        <div class="am-panel-bd am-scrollable-horizontal">
          <table class="am-table am-table-centered am-table-striped am-table-hover">
            <thead>
            <tr>
              <th class="table-id">编号</th>
              <th class="table-title">姓名</th>
              <th class="table-type">性别</th>
              <th>专业</th>
              <th>年级</th>
              <th>班级</th>
              <th>电话号码</th>
              <th>选题</th>
              <th>是否免答辩</th>
              <th>操作</th>
            </tr>
            </thead>
            <tbody id="chooseBody"></tbody>
          </table>
        </div>
        <footer class="am-panel-footer" style="height: 50px;">
          <div class="am-fr">
            <div id="news-Pagination-1"></div>
          </div>
        </footer>
<div>
        <form id="form1" name="form1" method="post" action="">
          <div class="Manager_style add_user_info">
            <div class="title_name">添加学生</div>
            <button class="btn btn-primary" type="button" id="Add_user_btn">添加学生</button>
            <div id="Add_user_style" style="display:none">
              <div class="add_user_style clearfix">
                <ul class="clearfix">
                  <li><label class="label_name">用户姓名</label> <input name="用户名" type="text"  class="" id="username" autocomplete="off"/><i style="color:#F60; ">*</i></li>
                  <li><label class="label_name">登录密码</label><input name="登录密码" type="password"  class="" id="userpassword" autocomplete="new-password"/><i style="color:#F60; ">*</i></li>
                  <li><label class="label_name">用户账号</label><input name="登录账号" type="text"  class="" id="account"/><i style="color:#F60; ">*</i></li>
                  <li><label class="label_name">用户电话</label><input name="用户电话" type="text"  class="" id="telephone"/><i style="color:#F60; ">*</i></li>
                  <li><label class="label_name">班级编号</label><input name="班级编号" type="text"  class="" id="class"/><i style="color:#F60; ">*</i></li>
                  <li>
                    <label class="am-radio-inline am-fl">
                      <input type="radio" name="radio11" value="1" data-am-ucheck> 男
                    </label>
                    <label class="am-radio-inline am-fl">
                      <input type="radio" name="radio11" value="0" data-am-ucheck> 女
                    </label>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </form>
</div>
      </div>
    </div>
  </div>
  <div class="am-modal am-modal-alert" tabindex="-1" id="userInfo-modal">
    <div class="am-modal-dialog">
      <div class="am-modal-hd">学生基本信息
        <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
      </div>
      <div class="am-modal-bd" id="userInfo-bd" style="margin-top: 10px;">
        <form class="am-form am-form-horizontal">
          <div class="am-form-group">
            <label for="userName" class="am-u-sm-2 am-form-label">姓名</label>
            <div class="am-u-sm-10">
              <input type="text" id="Name" name="doc-ipt-1">
            </div>
          </div>
          <div class="am-form-group">
            <label for="userName" class="am-u-sm-2 am-form-label">账号</label>
            <div class="am-u-sm-10">
              <input type="text" id="acc" name="doc-ipt-1">
            </div>
          </div>
          <div class="am-form-group">
            <label for="tel" class="am-u-sm-2 am-form-label">电话</label>
            <div class="am-u-sm-10">
              <input type="text" id="tel" name="doc-ipt-pwd-6">
            </div>
          </div>
          <div class="am-form-group">
            <label for="tel" class="am-u-sm-2 am-form-label">班级编号</label>
            <div class="am-u-sm-10">
              <input type="text" id="cla" name="doc-ipt-pwd-6">
            </div>
          </div>
          <div class="am-form-group">
            <label class="am-u-sm-2 am-form-label">性别</label>
            <div class="am-u-sm-10">
              <label class="am-radio-inline am-fl">
                <input type="radio" name="radio12" value="1" data-am-ucheck> 男
              </label>
              <label class="am-radio-inline am-fl">
                <input type="radio" name="radio12" value="0" data-am-ucheck> 女
              </label>
            </div>
          </div>
          <div class="am-form-group">
            <label class="am-u-sm-2 am-form-label">免答辩</label>
            <div class="am-u-sm-10">
              <label class="am-radio-inline am-fl">
                <input type="radio" name="radio13" value="1" data-am-ucheck> 是
              </label>
              <label class="am-radio-inline am-fl">
                <input type="radio" name="radio13" value="0" data-am-ucheck> 否
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="am-modal-footer">
        <span class="am-modal-btn" id="updateInfo_btn">修改</span>
      </div>
    </div>
  </div>
<script src="assets/js/jquery.min.js"></script>
<script type="text/javascript">
  window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>
<script type="text/javascript">
  if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>
<script type="text/javascript" src="assets/layer/layer.js"></script>
<script src="../js/jquery.min.js"></script>
<script src="../amazeui/js/amazeui.min.js"></script>
<script src="../js/jquery.pagination.js"></script>
<script type="text/javascript">
  $(function() {
    function chooseBody(data) {
      for(var num=0;num<data.list.length;num++){
        var td1=$('<td>').addClass('am-text-middle').text((num+1));
        var td2=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].user.userName));
        var td3=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].user.userGender==1?'男':'女'));
        var td4=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].classInfo.subject.subjectName));
        var td5=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].classInfo.grade.gradeName));
        var td6=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].classInfo.className));
        var td7=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].user.userTel));
        var td8;
        if(data.list[num].projectId==null){
          td8=$('<td>').addClass('am-text-middle').append($('<span>').text('未选'));
        }else{
          td8=$('<td>').addClass('am-text-middle').append($('<span>').text(data.list[num].project.projectName));
        }
        var goodBoy;
        if(data.list[num].goodBoy==1){
          goodBoy='是';
        }else{
          goodBoy='否';
        }
        var td9=$('<td>').addClass('am-text-middle').append($('<span>').text(goodBoy));
        var btn1=$('<button type="button">').attr('name','btn1'+num).addClass('btn btn-primary').text('修改');
        var btn2=$('<button type="button">').attr('name','btn2'+num).addClass('btn btn-primary').text('删除');
        var btn3=$('<button type="button">').attr('name','btn3'+num).addClass('btn btn-pink reset_Password').text('重置密码');
        var td10=$('<td class="User_Action_btn">').append(btn1).append(btn2).append(btn3);
        td10.find('button[name=btn1'+num+']').click(num,function (event){
          //alert(data.list[event.data].user.userName);
          $('#Name').val(data.list[event.data].user.userName);
          $('#acc').val(data.list[event.data].user.userAccount);
          $('#tel').val(data.list[event.data].user.userTel);
          $('#cla').val(data.list[event.data].classInfo.classId);
          $('input[name=radio12]').each(function(index,value){
            if($(value).val()==data.list[event.data].user.userGender){
              $(this).prop('checked','checked');
            }
          });
          $('input[name=radio13]').each(function(index,value){
            if($(value).val()==data.list[event.data].goodBoy){
              $(this).prop('checked','checked');
            }
          });
          $('#userInfo-modal').modal('open');
          $('#updateInfo_btn').off("click").on("click",function(){
            var formData1 = new FormData();
            formData1.append("userAccount",$('input[id=acc]').val());
            formData1.append("userName",$('input[id=Name]').val());
            formData1.append("userTel",$('input[id=tel]').val());
            formData1.append("userGender",$('input[name=radio12]:checked').val());
             formData1.append("userId",data.list[event.data].user.userId);
            ajax1=$.ajax({
              url:'/graduation/userController/updateUser',
              type:'post',
              data:formData1,
              processData:false,
              contentType:false,
            })
            var formData2=new FormData();
            formData2.append("studentId",data.list[event.data].studentId);
            formData2.append("classId",$('input[id=cla]').val());
            formData2.append("goodBoy",$('input[name=radio13]:checked').val());
            $.when(ajax1).done(function () {
              $.ajax({
                url:'/graduation/studentController/updateStudent',
                type:'post',
                data:formData2,
                processData:false,
                contentType:false,
              })
            });

          });
        });
        td10.find('button[name=btn2'+num+']').click(num,function (event){
          var formData1=new FormData();
          formData1.append("studentId",data.list[event.data].studentId);
          formData1.append("userId",data.list[event.data].user.userId);
          ajax1=$.ajax({
            url:'/graduation/studentController/deleteStudent',
            type:'post',
            data:formData1,
            processData:false,
            contentType:false,
          })
          var formData2=new FormData();
          formData2.append("userId",data.list[event.data].user.userId);
          formData2.append("userName",data.list[event.data].user.userName);
            $.when(ajax1).done(function (){
              $.ajax({
                url:'/graduation/userController/deleteUser',
                type:'post',
                data:formData2,
                processData:false,
                contentType:false,

                success:function (){
                  layer.alert('删除成功！',{
                    title: '提示框',
                    icon:1,
                  });
                }
              });
            })

        });

        td10.find('button[name=btn3'+num+']').click(num,function (event){


          var formData3=new FormData();
          formData3.append("userId",data.list[event.data].user.userId);
          formData3.append("userAccount",data.list[event.data].user.userAccount);
          $.ajax({
            url:'/graduation/userController/resetUser',
            type:'post',
            data:formData3,
            processData:false,
            contentType:false,

            success:function (){
              layer.msg('重置成功！', {time: 1000,icon: 1});
            }
          })
        });
        var tr=$('<tr>').append(td1).append(td2).append(td3).append(td4).append(td5).append(td6).append(td7).append(td8).append(td9).append(td10);
        $('#chooseBody').append(tr);
      }
    }

    var pageNum=1;
    var pageSize=8;
    var j=1;
    showTeacher(pageNum,pageSize);
    function showTeacher(pageNum,pageSize) {
      $.get('/graduation/adminController/getAllStudent',{
        pageNum:pageNum,
        pageSize:pageSize
      },function(data){
        //清除之前的数据
        $('#chooseBody').empty();
        if(data.list.length!=0){
          chooseBody(data);
          $('#news-Pagination-1').css('display','');
          if(j==1){
            //第一次调用
            j++;
            showPage1(data.total,pageSize);
          }
        }else{
          $('#news-Pagination-1').css('display','none');
        }
      });
    }

    function showPage1(total,pageSize){
      //分页
      $('#news-Pagination-1').pagination(total, {      //总记录数
        items_per_page:pageSize,          //每页显示多少条记录
        next_text:'下一页',
        prev_text:'上一页',
        num_display_entries:5,
        //num_edge_entries:2,  //连接分页主体的条数
        callback:handlePaginationClick
      });

    }
    function handlePaginationClick(new_page_index, pagination_container) {
      //清除之前的数据
      $('#chooseBody').empty();
      showTeacher(new_page_index+1,pageSize);
      return false;
    }
    function showPage2(total,pageSize){
      //分页
      $('#news-Pagination-1').pagination(total, {      //总记录数
        items_per_page:pageSize,          //每页显示多少条记录
        next_text:'下一页',
        prev_text:'上一页',
        num_display_entries:5,
        //num_edge_entries:2,  //连接分页主体的条数
        callback:handlePaginationClick2
      });

    }
    function handlePaginationClick2(new_page_index, pagination_container) {
      //清除之前的数据
      $('#chooseBody').empty();
      searchBody(new_page_index+1,pageSize);
      return false;
    }

    //查询
    var a=1;
    $('#searchTeacher').click(function() {
      var teacherName=$('#searchInput').val().trim();
      if(teacherName==null||teacherName==''){
        j=1;
        showTeacher(pageNum,pageSize);
        return false;
      }
      searchBody(teacherName,pageNum,pageSize);
    });
    $(document).keyup(function(event){
      if(event.keyCode ==13){
        var teacherName=$('#searchInput').val().trim();
        if(teacherName==null||teacherName==''){
          j=1;
          showTeacher(pageNum,pageSize);
          return false;
        }
        searchBody($('#searchInput').val().trim(),pageNum,pageSize);
      }
    });
    function searchBody(teacherName,pageNum,pageSize){
      $.get('/graduation/teacherController/findTeacherByTeacherName',{
        teacherName:teacherName,
        pageNum:pageNum,
        pageSize:pageSize
      },function(data){
        //清除之前的数据
        $('#chooseBody').empty();
        if(data.list.length!=0){
          chooseBody(data);
          $('#news-Pagination-1').css('display','');
          if(a==1){
            //第一次调用
            a++;
            showPage2(data.total,pageSize);
          }
        }else{
          $('#news-Pagination-1').css('display','none');
        }
      });
    }

    $('#Add_user_btn').on('click', function(){
      layer.open({
        type: 1,
        title: '添加用户',
        maxmin: true,
        shadeClose: true, //点击遮罩关闭层
        area : ['860px' , '400px'],
        content:$('#Add_user_style'),
        btn: ['添加','取消'],
        yes: function(index, layero){
          if ($("#username").val()==""){
            layer.alert('登录用户名不能为空!',{
              title: '提示框',
              icon:0,
            });
            return false;
          }
          if ($("#userpassword").val()==""){
            layer.alert('密码不能为空!',{
              title: '提示框',
              icon:0,
            });
            return false;
          }
          if ($("#account").val()==""){
            layer.alert('账号不能为空!',{
              title: '提示框',
              icon:0,
            });
            return false;
          }
          if ($("#telephone").val()==""){
            layer.alert('电话号码不能为空!',{
              title: '提示框',
              icon:0,
            });
            return false;
          }
          if ($("#class").val()==""){
            layer.alert('班级不能为空!',{
              title: '提示框',
              icon:0,
            });
            return false;
          }
          else{
            var formData1 = new FormData();
            formData1.append("userAccount",$('input[id=account]').val());
            formData1.append("userName",$('input[id=username]').val());
            formData1.append("userPassword",$('input[id=userpassword]').val());
            formData1.append("userTel",$('input[id=telephone]').val());
            formData1.append("userGender",$('input[name=radio11]:checked').val());
            ajax1=$.ajax({
              url:'/graduation/userController/insertUser',
              type:'post',
              data:formData1,
              processData:false,
              contentType:false,

            })
            var formData2=new FormData();
            formData2.append("studentId",$('input[id=account]').val());
            formData2.append("userId",$('input[id=account]').val());
            formData2.append("classId",$('input[id=class]').val());
            $.when(ajax1).done(function () {
              $.ajax({
                url:'/graduation/studentController/insertStudent',
                type:'post',
                data:formData2,
                processData:false,
                contentType:false,

                success:function (){
                  layer.alert('添加成功！',{
                    title: '提示框',
                    icon:1,
                  });
                }
              })
            });
            layer.close(index);
          }
        },
        cancel: function(index){
          layer.alert('确定退出！',{
            title: '提示框',
            icon:1,
          });
        }


      });
    });
    $('.reset_Password').on('click', function(){
      layer.confirm('是否重置密码，重置后原密码将失效？', {
        btn: ['重置','取消'] //按钮
      }, function(){
        layer.msg('重置成功！', {time: 1000,icon: 1});
      });
    });
  });

</script>
</body>

</html>